{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/yeldos.k/Desktop/final-map-app/client/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/yeldos.k/Desktop/final-map-app/client/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/yeldos.k/Desktop/final-map-app/client/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{apiSlice}from\"../../app/api/apiSlice\";import{logOut,setCredentials}from\"./authSlice\";export var authApiSlice=apiSlice.injectEndpoints({endpoints:function endpoints(builder){return{login:builder.mutation({query:function query(credentials){return{url:'/auth',method:'POST',body:_objectSpread({},credentials)};}}),sendLogout:builder.mutation({query:function query(){return{url:'/auth/logout',method:'POST'};},onQueryStarted:function onQueryStarted(arg,_ref){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var dispatch,queryFulfilled,_yield$queryFulfilled,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:dispatch=_ref.dispatch,queryFulfilled=_ref.queryFulfilled;_context.prev=1;_context.next=4;return queryFulfilled;case 4:_yield$queryFulfilled=_context.sent;data=_yield$queryFulfilled.data;console.log(data);dispatch(logOut());setTimeout(function(){dispatch(apiSlice.util.resetApiState());},1000);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 14:case\"end\":return _context.stop();}},_callee,null,[[1,11]]);}))();}}),refresh:builder.mutation({query:function query(){return{url:'/auth/refresh',method:'GET'};},onQueryStarted:function onQueryStarted(arg,_ref2){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var dispatch,queryFulfilled,_yield$queryFulfilled2,data,accessToken;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:dispatch=_ref2.dispatch,queryFulfilled=_ref2.queryFulfilled;_context2.prev=1;_context2.next=4;return queryFulfilled;case 4:_yield$queryFulfilled2=_context2.sent;data=_yield$queryFulfilled2.data;console.log(data);accessToken=data.accessToken;dispatch(setCredentials({accessToken:accessToken}));_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}},_callee2,null,[[1,11]]);}))();}})};}});var useLoginMutation=authApiSlice.useLoginMutation,useSendLogoutMutation=authApiSlice.useSendLogoutMutation,useRefreshMutation=authApiSlice.useRefreshMutation;export{useLoginMutation,useSendLogoutMutation,useRefreshMutation};","map":{"version":3,"names":["apiSlice","logOut","setCredentials","authApiSlice","injectEndpoints","endpoints","builder","login","mutation","query","credentials","url","method","body","_objectSpread","sendLogout","onQueryStarted","arg","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","dispatch","queryFulfilled","_yield$queryFulfilled","data","wrap","_callee$","_context","prev","next","sent","console","log","setTimeout","util","resetApiState","t0","stop","refresh","_ref2","_callee2","_yield$queryFulfilled2","accessToken","_callee2$","_context2","useLoginMutation","useSendLogoutMutation","useRefreshMutation"],"sources":["C:/Users/yeldos.k/Desktop/final-map-app/client/client/src/features/auth/authApiSlice.js"],"sourcesContent":["import { apiSlice } from \"../../app/api/apiSlice\"\r\nimport { logOut, setCredentials } from \"./authSlice\"\r\n\r\nexport const authApiSlice = apiSlice.injectEndpoints({\r\n    endpoints: builder => ({\r\n        login: builder.mutation({\r\n            query: credentials => ({\r\n                url: '/auth',\r\n                method: 'POST',\r\n                body: { ...credentials }\r\n            })\r\n        }),\r\n        sendLogout: builder.mutation({\r\n            query: () => ({\r\n                url: '/auth/logout',\r\n                method: 'POST',\r\n            }),\r\n            async onQueryStarted(arg, { dispatch, queryFulfilled }) {\r\n                try {\r\n                    const { data } = await queryFulfilled\r\n                    console.log(data)\r\n                    dispatch(logOut())\r\n                    setTimeout(() => {\r\n                        dispatch(apiSlice.util.resetApiState())\r\n                    }, 1000)\r\n                } catch (err) {\r\n                    console.log(err)\r\n                }\r\n            }\r\n        }),\r\n        refresh: builder.mutation({\r\n            query: () => ({\r\n                url: '/auth/refresh',\r\n                method: 'GET',\r\n            }),\r\n            async onQueryStarted(arg, { dispatch, queryFulfilled }) {\r\n                try {\r\n                    const { data } = await queryFulfilled\r\n                    console.log(data)\r\n                    const { accessToken } = data\r\n                    dispatch(setCredentials({ accessToken }))\r\n                } catch (err) {\r\n                    console.log(err)\r\n                }\r\n            }\r\n        }),\r\n    })\r\n})\r\n\r\nexport const {\r\n    useLoginMutation,\r\n    useSendLogoutMutation,\r\n    useRefreshMutation,\r\n} = authApiSlice "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}