{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/yeldos.k/Desktop/final-map-app/client/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/yeldos.k/Desktop/final-map-app/client/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/yeldos.k/Desktop/final-map-app/client/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useContext,useRef}from'react';import{useNavigate,Link}from'react-router-dom';import{useDispatch}from'react-redux';import{setCredentials}from'./authSlice';import{useLoginMutation}from'./authApiSlice';import usePersist from'../../hooks/usePersist';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Auth=function Auth(){var userRef=useRef();var errRef=useRef();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showPassword=_useState6[0],setShowPassword=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),errMsg=_useState8[0],setErrMsg=_useState8[1];var _usePersist=usePersist(),_usePersist2=_slicedToArray(_usePersist,2),persist=_usePersist2[0],setPersist=_usePersist2[1];var navigate=useNavigate();var dispatch=useDispatch();var _useLoginMutation=useLoginMutation(),_useLoginMutation2=_slicedToArray(_useLoginMutation,2),login=_useLoginMutation2[0],isLoading=_useLoginMutation2[1].isLoading;// useEffect(() => {\n//   userRef.current.focus()\n// }, [])\nuseEffect(function(){setErrMsg('');},[username,password]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$login,accessToken,_err$data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return login({username:username,password:password});case 4:_yield$login=_context.sent;accessToken=_yield$login.accessToken;dispatch(setCredentials({accessToken:accessToken}));setUsername('');setPassword('');navigate('/dash');_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);if(_context.t0.status){setErrMsg(\"Нет ответа от сервера!\");}else if(_context.t0.status===400){setErrMsg(\"Неправильный Имя или Пароль!\");}else if(_context.t0.status===401){setErrMsg(\"Не удалось авторизоваться!\");}else{setErrMsg((_err$data=_context.t0.data)===null||_err$data===void 0?void 0:_err$data.message);}// errRef.current.focus();\ncase 15:case\"end\":return _context.stop();}},_callee,null,[[1,12]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var handleUserInput=function handleUserInput(e){return setUsername(e.target.value);};var handlePwdInput=function handlePwdInput(e){return setPassword(e.target.value);};var handleToggle=function handleToggle(){return setPersist(function(prev){return!prev;});};var errClass=errMsg?\"errmsg\":\"offscreen\";if(isLoading)return/*#__PURE__*/_jsx(\"p\",{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"signupScreen\",children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errClass,\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",className:\"title\",children:\"\\u0410\\u0432\\u0442\\u043E\\u0440\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"input\",{className:\"inputs\",id:\"username\",type:\"text\",placeholder:\"\\u041B\\u043E\\u0433\\u0438\\u043D\",ref:userRef,value:username,onChange:handleUserInput,autoComplete:\"off\",required:true}),/*#__PURE__*/_jsx(\"input\",{className:\"inputs\",type:showPassword?'text':'password',placeholder:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",id:\"password\",onChange:handlePwdInput,value:password,required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){return setShowPassword(!showPassword);},children:showPassword?'Скрыть пароль':'Показать пароль'}),/*#__PURE__*/_jsx(\"button\",{children:\"\\u0412\\u043E\\u0439\\u0442\\u0438\"}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"persist\",className:\"form__persist\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",className:\"form__checkbox\",id:\"presist\",onChange:handleToggle,checked:persist}),\"\\u0414\\u043E\\u0432\\u0435\\u0440\\u044F\\u044E \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0435\"]})]})]})})});};export default Auth;","map":{"version":3,"names":["useState","useEffect","useContext","useRef","useNavigate","Link","useDispatch","setCredentials","useLoginMutation","usePersist","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Auth","userRef","errRef","_useState","_useState2","_slicedToArray","username","setUsername","_useState3","_useState4","password","setPassword","_useState5","_useState6","showPassword","setShowPassword","_useState7","_useState8","errMsg","setErrMsg","_usePersist","_usePersist2","persist","setPersist","navigate","dispatch","_useLoginMutation","_useLoginMutation2","login","isLoading","handleSubmit","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","_yield$login","accessToken","_err$data","wrap","_callee$","_context","prev","next","preventDefault","sent","t0","status","data","message","stop","_x","apply","arguments","handleUserInput","target","value","handlePwdInput","handleToggle","errClass","children","className","ref","onSubmit","htmlFor","id","type","placeholder","onChange","autoComplete","required","onClick","checked"],"sources":["C:/Users/yeldos.k/Desktop/final-map-app/client/client/src/features/auth/Auth.jsx"],"sourcesContent":["import { useState, useEffect, useContext, useRef } from 'react';\r\nimport { useNavigate, Link } from 'react-router-dom';\r\nimport { useDispatch } from 'react-redux';\r\nimport { setCredentials } from './authSlice';\r\nimport { useLoginMutation } from './authApiSlice';\r\n\r\nimport usePersist from '../../hooks/usePersist';\r\n\r\n\r\nconst Auth = () => {\r\n  const userRef = useRef()\r\n  const errRef = useRef()\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [errMsg, setErrMsg] = useState('');\r\n  const [persist, setPersist] = usePersist()\r\n\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch()\r\n\r\n  const [login, { isLoading}] = useLoginMutation()\r\n\r\n  // useEffect(() => {\r\n  //   userRef.current.focus()\r\n  // }, [])\r\n\r\n  useEffect(() => {\r\n    setErrMsg('');\r\n  }, [username, password])\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault()\r\n    try {\r\n      const { accessToken } = await login({ username, password })\r\n      dispatch(setCredentials({ accessToken }))\r\n      setUsername('')\r\n      setPassword('')\r\n      navigate('/dash')\r\n    } catch(err) {\r\n      if(err.status) {\r\n        setErrMsg(\"Нет ответа от сервера!\");\r\n      } else if (err.status === 400) {\r\n        setErrMsg(\"Неправильный Имя или Пароль!\");\r\n      } else if (err.status === 401) {\r\n        setErrMsg(\"Не удалось авторизоваться!\");\r\n      } else {\r\n        setErrMsg(err.data?.message);\r\n      }\r\n      // errRef.current.focus();\r\n    }\r\n  }\r\n\r\n  const handleUserInput = (e) => setUsername(e.target.value)\r\n  const handlePwdInput = (e) => setPassword(e.target.value)\r\n  const handleToggle = () => setPersist(prev => !prev)\r\n\r\n  const errClass = errMsg ? \"errmsg\" : \"offscreen\"\r\n\r\n  if(isLoading) return <p>Загрузка...</p>\r\n\r\n  \r\n\r\n  return (\r\n    <>\r\n    <div className='full'>\r\n    <div className='signupScreen'>\r\n      <p ref={errRef} className={errClass} aria-live='assertive'>{errMsg}</p>\r\n        <form onSubmit={handleSubmit}>\r\n          <label htmlFor='username' className='title'>Авторизация</label>\r\n          <input \r\n                className='inputs'\r\n                id=\"username\"\r\n                type=\"text\"\r\n                placeholder='Логин'\r\n                ref={userRef}\r\n                value={username}\r\n                onChange={handleUserInput}\r\n                autoComplete='off'\r\n                required\r\n           />\r\n          <input className='inputs'\r\n                type={showPassword ? 'text' : 'password'}\r\n                placeholder='Пароль'\r\n                id='password'\r\n                onChange={handlePwdInput}\r\n                value={password}\r\n                required\r\n          />\r\n          <button type=\"button\" onClick={() => setShowPassword(!showPassword)}>\r\n              {/* Кнопка для скрытия/отображения пароля */}\r\n              {showPassword ? 'Скрыть пароль' : 'Показать пароль'}\r\n          </button>\r\n          <button>Войти</button>\r\n          <label htmlFor='persist' className='form__persist'>\r\n            <input\r\n              type='checkbox'\r\n              className='form__checkbox'\r\n              id='presist'\r\n              onChange={handleToggle}\r\n              checked={persist}\r\n            />\r\n            Доверяю странице\r\n          </label>\r\n        </form>\r\n        {/* {error && <p>{error}</p>} */}\r\n    </div>\r\n    </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Auth"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}